# Техническая документация по системе спавна предметов и лута

#### Seters:

**SetLootClasses**\
Извлекает из таблицы `LootCostTable` предметы и сортирует их в массивы `RareLootClasses` и `CheapLootClasses`. Затем эти массивы добавляются в `SpawnList`:

* `RareLootClasses` должны находиться под индексом `1`.
* `CheapLootClasses` — под индексом `2`.

***

#### Geters:

#### FLootCostRow GetLootClassByType(ELootType LootType)

Функция выбирает случайную строку из таблицы `DT_LootCostTable`. Если `LootType` выбранной строки совпадает с заданным `LootType`, возвращает эту строку. В противном случае продолжает искать подходящую строку. Количество итераций ограничено длиной таблицы.\
Если цикл не находит подходящую строку, функция возвращает пустую структуру `FLootCostRow`.

***

#### Spawn:

**SpawnItems**

1. Вызывает функцию `SpawnKey`.
2. Извлекает индекс `0` из `SpawnList`.
3. Пока в `SpawnList` и массиве `ItemSockets` есть валидный индекс `0`, выполняется цикл `while`.
   * В цикле выбирается случайный индекс из массива `ItemSockets`.
   * Если количество итераций цикла превышает число заспавненных коробок, происходит спавн предмета. После спавна предмета:
     * Сокет удаляется из массива.
     * Если в локальном массиве под выбранным индексом `ItemCount` меньше или равен `0`, предмет удаляется из массива. В противном случае `ItemCount` уменьшается на `1`.
4. Если коробок заспавнилось недостаточно:
   * Проверяется, может ли коробка появиться в выбранном сокете.
   * Если да, то вызывается `SpawnBox`, передавая ссылку на сокет.
   * После выполнения `SpawnBox` сокет удаляется из массива, а локальный массив предметов обновляется.

**SpawnKey**\
Спавнит ключ в случайном сокете и удаляет этот сокет из массива `ItemSockets`.

**SpawnBox**\
Имеет один входной параметр — ссылку на `Socket`.

1. Извлекает индекс `0` из `SpawnList`.
2. Берёт первый предмет из этого индекса и сохраняет его роль.
3. В цикле `for` (2 итерации):
   * Выбирается случайный предмет из локального массива.
   * Если случайное число больше `BoxItemChanceSpawn`, проверяется, совпадает ли роль предмета с ролью первого предмета (индекс `0`).
   * Если роли совпадают, предмет добавляется в `BoxSpawnItemList`, удаляется из `SpawnItemList` (если `ItemCount` <= 0), а переменная `SpawnedItems` увеличивается на `1`.
4. После завершения цикла спавнится сундук, который через цикл `ForEachLoop` добавляет в себя все предметы.
5. Предметы удаляются из `SpawnList`, и функция возвращает число заспавненных предметов.

**SpawnLoot**

Алгоритм спавна предметов:

1. **Спавн дорогих предметов**:
   * Для каждого заспавненного предмета используемые сокеты удаляются из массива доступных.
2. **Спавн обычных предметов**:
   * Процесс продолжается до тех пор, пока общая стоимость предметов не превысит заданную стоимость в таблице.
   * Если лимит стоимости достигнут, спавн обычных предметов прекращается.
3. **Спавн мусора**:
   * После завершения этапа с обычными предметами начинается спавн мусора, заполняющий оставшиеся доступные сокеты.

